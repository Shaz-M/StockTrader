{% extends 'base.html' %} {% load static %} {% block css %}
<link rel="stylesheet" href="{% static 'stocks/styles.css' %}" />

{% endblock css %} {% block content %}

<div id="mainDisplay" class="container mt-5">
  <div>
    <div class="nameDiv">
      <h1 class="mb-0" id="ticker">{{ stockObj.ticker }}</h1>
      <h6 id="fullName">{{ stockObj.fullName }}</h6>
    </div>
    <div class="priceDiv">
      <h2 id="price" class="currPrice"></h2>
      <h6 id="change"></h6>
    </div>
  </div>
  <!-- TradingView Widget BEGIN -->
  <div class="tradingview-widget-container">
    <div id="tradingview_b3383"></div>
    <script
      type="text/javascript"
      src="https://s3.tradingview.com/tv.js"
    ></script>
    <script type="text/javascript">
      let ticker = $("#ticker").text();
      ticker = ticker.toUpperCase();
      new TradingView.MediumWidget({
        symbols: [[ticker + "|1D"]],
        chartOnly: true,
        width: "100%",
        height: "100%",
        locale: "en",
        colorTheme: "dark",
        isTransparent: false,
        autosize: true,
        showVolume: false,
        hideDateRanges: false,
        scalePosition: "right",
        scaleMode: "Normal",
        fontFamily:
          "-apple-system, BlinkMacSystemFont, Trebuchet MS, Roboto, Ubuntu, sans-serif",
        noTimeScale: false,
        valuesTracking: "1",
        chartType: "line",
        fontColor: "#787b86",
        gridLineColor: "rgba(240, 243, 250, 0.06)",
        color: "rgba(8, 153, 129, 1)",
        container_id: "tradingview_b3383",
      });
    </script>
  </div>
  <!-- TradingView Widget END -->
  {% if request.user.is_authenticated %}
  <!-- Buy/Sell -->
  <div class="infoDiv pt-2">
    <ul class="nav nav-tabs" id="buy/sell" role="tablist">
      <li class="nav-item">
        <a
          class="nav-link buy"
          id="buy-tab"
          data-toggle="tab"
          href="#buypanel"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          >Buy</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link sell"
          id="sell-tab"
          data-toggle="tab"
          href="#sellpanel"
          role="tab"
          aria-controls="profile"
          aria-selected="false"
          >Sell</a
        >
      </li>
    </ul>
    <div class="tab-content" id="buysell-tab">
      <div
        class="tab-pane fade"
        id="buypanel"
        role="tabpanel"
        aria-labelledby="home-tab"
      >
        <div>
          Order Type: Market Order<br />
          Trade Price: <span class="currPrice"></span><br />
          <form id="buy-form" method="POST" action="">
            {% csrf_token %}
            <label for="quantity">Quantity:</label>
            <input type="number" min="0" id="quantity" name="quantity" /><br />
            <input type="hidden" name="orderType" value="Buy" />
            <button type="submit">Submit Order</button>
          </form>
        </div>
      </div>
      <div
        class="tab-pane fade"
        id="sellpanel"
        role="tabpanel"
        aria-labelledby="profile-tab"
      >
        Order Type: Market Order<br />
        Trade Price: <span class="currPrice"></span><br />
        <form id="sell-form" method="POST" action="">
          {% csrf_token %}
          <label for="quantity">Quantity:</label>
          <input type="number" min="0" id="quantity" name="quantity" /><br />
          <input type="hidden" name="orderType" value="Sell" />
          <button type="submit">Submit Order</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Buy/Sell END -->
  {% endif %}
  <div class="pt-2">
    <hr class="line-break" />
  </div>
  <!-- Postions -->
  {% if stockObj.shares %}
  <h4>Your Position</h4>
  <div class="spaceBetween">
    <div>
      Shares<br />
      <span class="positionInfo" id="shares">{{ stockObj.shares }}</span>
    </div>
    <div>
      Average Price<br />
      <span class="positionInfo" id="avgPrice"
        >${{ stockObj.avgBuyPrice }}</span
      >
    </div>
    <div>
      Net liq.<br />
      <span class="positionInfo" id="netLiq"></span>
    </div>
    <div>
      P/L Open<br />
      <span class="positionInfo" id="plOpen"></span>
    </div>
    <div>
      P/L Day<br />
      <span class="positionInfo" id="plDay"></span>
    </div>
  </div>
  <!-- Postions END -->
  <div class="pt-2">
    <hr class="line-break" />
  </div>
  {% endif %}
  <div class="infoDiv pt-2">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a
          class="nav-link active"
          id="price-tab"
          data-toggle="tab"
          href="#priceInfo"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          >Price Information</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          id="fundamental-tab"
          data-toggle="tab"
          href="#fundamentalInfo"
          role="tab"
          aria-controls="profile"
          aria-selected="false"
          >Company Fundamentals</a
        >
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div
        class="tab-pane fade show active"
        id="priceInfo"
        role="tabpanel"
        aria-labelledby="home-tab"
      >
        <div class="pt-2 pb-2">
          <div class="parent">
            <div class="child">
              <div class="label">Prev Close Price</div>
              <div class="info-tab-section" id="prevClose">
                ${{stockObj.prevClose}}
              </div>
            </div>
            <div class="child">
              <div class="label">Bid Price</div>
              <div class="info-tab-section" id="bidPrice"></div>
            </div>
            <div class="child">
              <div class="label">Ask Price</div>
              <div class="info-tab-section" id="askPrice"></div>
            </div>
            <div class="child">
              <div class="label">Avg Volume</div>
              <div class="info-tab-section" id="avgVolume">
                {{stockObj.volume}}
              </div>
            </div>
            <div class="child">
              <div class="label">High</div>
              <div class="info-tab-section" id="high"></div>
            </div>
            <div class="child">
              <div class="label">Low</div>
              <div class="info-tab-section" id="low"></div>
            </div>
            <div class="child">
              <div class="label">52 Week Low</div>
              <div class="info-tab-section" id="52low"></div>
            </div>
            <div class="child">
              <div class="label">52 Week High</div>
              <div class="info-tab-section" id="52high"></div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="tab-pane fade"
        id="fundamentalInfo"
        role="tabpanel"
        aria-labelledby="profile-tab"
      >
        ...
      </div>
    </div>
  </div>
  <div class="pt-2">
    <hr class="line-break" />
  </div>

  <div>
    <h4>Company Bio</h4>
    <span id="description">{{stockObj.description}}</span>
  </div>
</div>

<script src="{% static 'stocks/main.js' %}"></script>
{% endblock content %}
