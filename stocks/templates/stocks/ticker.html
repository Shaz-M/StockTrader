<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <title>Ticker</title>
</head>
<body>
    <h1 id='ticker'>{{ ticker }}</h1>
    <p id='price'></p>
    {% if request.user.is_authenticated %}
    <form action="" method="POST">
        {% csrf_token %}
        {{ OrderForm.as_p }}
        <input type="submit" value="Submit">
    </form>
    {% endif %}
    <script>
        function fetchdata(ticker){
        $.ajax({
        url: 'https://api.tdameritrade.com/v1/marketdata/'+ticker+'/quotes?apikey=D57TGYGPEEXE5IQRTHZG4EVDBATABE3B',
        type: 'get',
        dataType: "json",
        success: function(data){
            // Perform operation on return valud
            let price = data[ticker].lastPrice;
            $("#price").text(price);
            console.log(price);
        },
        complete:function(data){
            setTimeout(fetchdata,5000,ticker);
        }
        });
        }

$(document).ready(function(){
    let ticker = $('#ticker').text();
    ticker = ticker.toUpperCase();
 fetchdata(ticker);
});
    </script>
</body>
</html>